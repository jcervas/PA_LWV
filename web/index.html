<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>LWV v. Pennsylvania | Political Geography</title>
<link href="css/palwv.css" rel="stylesheet" type="text/css"/>
<link href="https://loading.io/css/loading.css" rel="stylesheet" type="text/css">
</head>
<body>
<!--<script src="js/d3.v3.min.js"></script>-->
<!--<script src="js/topojson.v1.min.js"></script>-->
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="https://d3js.org/d3.v4.min.js"></script> <!-- Inclusion of d3 v4 -->
<script src="https://d3js.org/queue.v1.min.js"></script>
<!--<script src="https://d3js.org/d3.v5.min.js"></script>-->
	
	<style>
body {
	font-family:nyt-imperial,georgia,'times new roman',times,serif;
	height: 100%;
	text-align: center;
	text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
}

.background {
  fill: none;
  pointer-events: all;
}

.svg-container {
    display: inline-block;
    position: relative;
    width: 90%;
    padding-bottom: 56%;
    vertical-align: top;
	align-content: center;
    overflow: hidden;
/*	background-image: linear-gradient(72deg, #595959, #262626);*/
}
.svg-content-responsive {
    display: inline-block;
    position: absolute;
    top: 0;
    left: 0;
}
		
.feature {
  fill: none;
  fill-opacity: 0.3;
	stroke: #000;
	stroke-opacity: 0;
  cursor: pointer;
}


.main_title {
	position: absolute;
	color: #2d2d2d;
    line-height: 1em;
    font-weight: 700;
    font-size: 70px;
    font-family: avenir-lt-w01_85-heavy1475544,sans-serif;
    opacity: 1;
/*	margin-left: 200px;*/
	letter-spacing: -8px;
	padding-bottom: 4px;
	padding-top: 100px;
}

.sub_title {
	color: #2d2d2d;
    line-height: 0.75em;
    font-weight: 500;
    font-size: 78px;
    font-family: avenir-lt-w01_85-heavy1475544,sans-serif;
    opacity: .85;
	margin-left: 200px;
	padding-top: 50px;
	letter-spacing: -8px;
}
		
.main_text {
		margin-bottom:0.78125rem;
		font-family:nyt-imperial,georgia,'times new roman',times,serif;
		font-size:1.125rem;
		line-height:1.5625rem;
		margin-left:20px;
		max-width:600px;
	}
	
.main_text_indent {
		margin-bottom:0.78125rem;
		margin-top:0;
		font-family:nyt-imperial,georgia,'times new roman',times,serif;
		font-size:1rem;
		line-height:1.5625rem;
		margin-left:30px;
		margin-right:20px;
		width:calc(100% - 40px);
		max-width:600px;
	}

.plan_mesh {
	stroke: #252525;
	stroke-width: 1.5px;
	stroke-opacity: 1;
	/*	stroke-dasharray: 1;*/
	stroke-linecap: round;
	stroke-linejoin: round;
	fill: none;
	fill-opacity: 0.5;
}

.outline {
	fill: none;
	stroke: #000;
	stroke-width: 4.0px;
	stroke-opacity: 1;
	/*	stroke-dasharray: 1;*/
	stroke-linecap: round;
	stroke-linejoin: round;
		}
		
.water {
	fill: #3C4E73;
	stroke: none;
}
		
.states {
	fill: #e5e5e5;
	stroke: #fff;
	stroke-width:1px;
}
.cities {
	fill: #000;
	opacity:1;
	stroke: #fff;
}

path.q0-11 {
  fill: #67001f;
}

path.q1-11 {
  fill: #b2182b;
}

path.q2-11 {
  fill: #d6604d;
}

path.q3-11 {
  fill: #f4a582;
}

path.q4-11 {
  fill: #fddbc7;
}

path.q5-11 {
  fill: #f7f7f7;
}

path.q6-11 {
  fill: #d1e5f0;
}

path.q7-11 {
  fill: #92c5de;
}

path.q8-11 {
  fill: #4393c3;
}

path.q9-11 {
  fill: #2166ac;
}

path.q10-11 {
  fill: #053061;
}
		
.district {
	fill: none;
	stroke: #000;
	stroke-width: 2.95px;
	stroke-opacity: 1;
	/*	stroke-dasharray: 1;*/
	stroke-linecap: round;
	stroke-linejoin: round;
}
	
.dotted {
	fill: none;
	stroke: #fff;
	stroke-width: 2.05px;
	stroke-opacity: 1;
/*	stroke-dasharray: 1,2,1;*/
}

div.tooltip {
  position: absolute;	
  text-align:left;	
  width: 130px;	
/*  height: 50px;		*/
  padding: 1px;	
  padding-left: 2px;
  font: 12px sans-serif;	
/*  background: #7D7D7D;	*/
  border: 1px;
  border-color: rgba(0, 0, 0, 0.12);
  border-radius: 6px;
  opacity: .7;
  line-height: 1;
  display: none;
  background: white;
  box-shadow: 0 0 16px rgba(0, 0, 0, 0.12);
	}			
		
.info {
	width: 100%;
	background: #fff;
	text-decoration-color: #000;
	padding: 10px;
}
		
.districtnames {
	font-family:  "Franklin Gothic Book", Arial;
	font-weight: 300;
	text-transform: uppercase;
	letter-spacing: 4px;
	font-size: 16px;
	fill: #967b35;
}

.land {
  fill: #eee;
}

.border--counties {
  fill: none;
  stroke: #fff;
}

.land--counties {
  fill-opacity: .2;
  stroke-linejoin: round;
  stroke-linecap: round;
}
	
.load {
	position: relative;
	display: none;
}	
</style>
<!----------------------------------------------->	
	<div id="palwv"><div id="loader" class="load"><div class="ld ld-hourglass ld-spin-fast" style="font-size:64px;color:#000"></div></div></div>
<!----------------------------------------------->
<script>
//Map dimensions (in pixels)
var width = 960,
	height = 600,
	active = d3.select(null);
	
var aspect = width / height,
    chart = d3.select('#chart');
	
d3.select(window)
  .on("resize", function() {
    var targetWidth = svg.node().getBoundingClientRect().width;
    svg.attr("width", targetWidth);
    svg.attr("height", targetWidth / aspect);
  });
	
//Map projection
var projection = d3.geoConicEqualArea()
    .scale(11087.490584939113)
    .center([-77.8004853439081,40.876791119507395]) //projection center
    .parallels([39.719842948590106,42.24288756332322]) //parallels for conic projection
    .rotate([77.8004853439081]) //rotation for conic projection
    .translate([-9509.253406464926,-4418.309303094702]) //translate to center the map in view

var path = d3.geoPath().projection(projection); 
	
//Create an SVG
var svg = d3.selectAll("#palwv")
	.append("div")
	.classed("svg-container", true)
	.append("svg")
  		.attr("preserveAspectRatio", "xMidYMid meet")
		.attr("viewBox", [0, 0, width, height])
		.classed("svg-content-responsive", true)
	.on("click", stopped, true);
	
var loader = d3.select('#loader')
	.style("display", "block");

//Create a tooltip, hidden at the start
var tooltip = d3.select("body").append("div")
	.attr("class","tooltip");

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height)
    .on("click", reset);
	
var color = d3.scaleQuantize()
    .domain([0,1])
    .range(d3.range(11).map(function(i) { return "q" + i + "-11"; }));
	
var zoom = d3.zoom()
    .scaleExtent([1, 8])
    .on("zoom", zoomed);
	
var g = svg.append("g");

//Container for the gradients
var defs = svg.append("defs");

//Filter for the outside glow
var filter = defs.append("filter")
    	.attr("id","glow");
	filter.append("feGaussianBlur")
    	.attr("stdDeviation","3.5")
    	.attr("result","coloredBlur");
var feMerge = filter.append("feMerge");
	feMerge.append("feMergeNode")
    	.attr("in","coloredBlur");
	feMerge.append("feMergeNode")
    	.attr("in","SourceGraphic");
	
svg.append("text")
    .attr('class', 'main_title')
    .attr('x', width/2)
    .attr('y', 70)
    .style('text-anchor', 'middle')
    .text("Pennsylvania Enacted")
<!----------------------------------------------->	
	queue()
		.defer(d3.json, "json/vtd.json")
		.defer(d3.csv, "pa_data.csv")
		.defer(d3.json, "json/cities.json")
		.defer(d3.json, "json/enacted.json")
		.defer(d3.json, "json/court.json")
		.defer(d3.json, "json/joint.json")
		.defer(d3.json, "json/govwolf.json")
		.defer(d3.json, "json/PA.json")
			.await(ready);

function ready(error, vtd, pa_data, cities, enacted, court, joint, govwolf, PA) {
  if (error) return console.log(error); //unknown error, check the console

// remove the loading text
    d3.select('#loader').remove();

	// Create empty objects for holding dataset
	var court_data = {};
	var enacted_data = {};
	var joint_data = {};
	var govwolf_data = {};

//  Create a path for each map feature in the data	
 svg.append("path")
	svg.selectAll("g")
    .data(topojson.feature(vtd, vtd.objects.vtd).features) //generate features from TopoJSON
	  .enter().append("path")
		.attr("class", function(d) { return (typeof color(d.properties.dem) == "string" ? color(d.properties.dem) : ""); })
		.attr("d", path)
//		.on("click", clicked)
		.on("mouseover", showTooltip)
		.on("mousemove", moveTooltip)
		.on("mouseout", hideTooltip);
	
svg.append("path")
      .datum(topojson.mesh(enacted, enacted.objects.enacted, function(a, b) { return a !== b; }))
      .attr("class", "district")
	.style("filter", "url(#glow)")
      .attr("d", path);

svg.append("path")
      .datum(topojson.mesh(enacted, enacted.objects.enacted, function(a, b) { return a !== b; }))
      .attr("class", "dotted")
//	.style("filter", "url(#glow)")
      .attr("d", path);

	
var g = svg.append("g")
//        .datum(topojson.merge(vtd, vtd.objects.vtd.geometries.filter(function(d) { return d.properties.enacted == 12; })))
//        .attr("class", "land--counties")
//        .style("opacity", 1);
//
//    g.selectAll("path")
//        .data(function(d) { return d.coordinates; })
//      .enter().append("path")
//        .datum(function(d) { return {type: "Polygon", coordinates: d}; })
//        .style("fill", function(d, i) { return color(i); })
//        .style("stroke", function(d, i) { return d3.lab(color(i)).darker(); })
//        .attr("d", path);
	
////STATE BORDER
  g.append("path")
      .datum(topojson.merge(vtd, vtd.objects.vtd.geometries.filter(function(d) { return d.properties.NAMELSAD; })))
      .attr("class", "outline")
	.style("filter", "url(#glow)")
      .attr("d", path);	
<!----------------------------------------------->
//svg.selectAll('.cities')
//	.data(topojson.feature(cities, cities.objects.cities).features)
//	.enter()
//	.append('path')
//	.style("filter", "url(#glow)")
//	.attr('d', path.pointRadius(4))
//	.attr('class', 'cities');
console.log(topojson.feature(cities, cities.objects.cities).features)
svg.selectAll("text")
	.data(topojson.feature(cities, cities.objects.cities).features)
	.enter()
	.append("text")
	.text(function(d){return d.properties.NAME10;})
	.attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
	.attr("dx", "-3em")
	.attr("dy", "0.5em");

	};	
<!----------------------------------------------->
// https://bl.ocks.org/iamkevinv/0a24e9126cd2fa6b283c6f2d774b69a2
// Zoom to feature on click
function clicked(d) {
  if (active.node() === this) return reset();
  active.classed("active", false);
  active = d3.select(this).classed("active", true);

    var bounds = path.bounds(d),
//    var bounds = geoPathGenerator.bounds(d)
	  dx = bounds[1][0] - bounds[0][0],
      dy = bounds[1][1] - bounds[0][1],
      x = (bounds[0][0] + bounds[1][0]) / 2,
      y = (bounds[0][1] + bounds[1][1]) / 2,
      scale = Math.max(1, Math.min(8, 0.9 / Math.max(dx / width, dy / height))),
      translate = [width / 2 - scale * x, height / 2 - scale * y];

  svg.transition()
      .duration(950)
      // .call(zoom.translate(translate).scale(scale).event); // not in d3 v4
      .call( zoom.transform, d3.zoomIdentity.translate(translate[0],translate[1]).scale(scale) ); // updated for d3 v4
}
<!----------------------------------------------->
function reset() {
  active.classed("active", false);
  active = d3.select(null);

  svg.transition()
      .duration(950)
      // .call( zoom.transform, d3.zoomIdentity.translate(0, 0).scale(1) ); // not in d3 v4
      .call( zoom.transform, d3.zoomIdentity ); // updated for d3 v4
}
<!----------------------------------------------->
function zoomed() {
  svg.style("stroke-width", 1.5 / d3.event.transform.k + "px");
  svg.attr("transform", d3.event.transform); // updated for d3 v4
}

// If the drag behavior prevents the default click,
// also stop propagation so we don’t click-to-zoom.
function stopped() {
  if (d3.event.defaultPrevented) d3.event.stopPropagation();
}
<!----------------------------------------------->	
//Position of the tooltip relative to the cursor
var tooltipOffset = {x: 5, y: -65};
var percentage = d3.format(".1%");
var thousand = d3.format(",")
//Create a tooltip, hidden at the start
function showTooltip(d) {
	moveTooltip();

	tooltip.style("display","block")
		.html("<a><b><center><u>" + d.properties.NAMELSAD + "</u></center></b></a><a><b>Total Persons: </b>" + thousand(+d.properties.TAPERSONS) + "</a><br><a><b>Trump '16: </b>" + percentage(1-d.properties.dem) + "</a><br><a><b>Clinton '16: </b>" + percentage(d.properties.dem) + "</a>");
}
//Move the tooltip to track the mouse
function moveTooltip() {
	tooltip.style("top",(d3.event.pageY+tooltipOffset.y)+"px")
	  	.style("left",(d3.event.pageX+tooltipOffset.x)+"px");
}
<!----------------------------------------------->
//Create a tooltip, hidden at the start
function hideTooltip() {
	tooltip.style("display","none");	
}	
</script>
	<!----------------------------------------------->
</body>
</html>
